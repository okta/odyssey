test_suites:
  - name: "build"
    abort_commit_on_failure: true
    criteria: MERGE
    prereq_test_suite_names:
      - "lint"
      - "test"
      - "typecheck"
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "1"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn build
        name: Build Packages
    timeout: "20"

  - name: publish
    abort_commit_on_failure: true
    script_path: /root/okta/odyssey/scripts
    sort_order: "2"
    timeout: "15"
    script_name: publish
    criteria: MERGE
    prereq_test_suite_names:
      - "build"
    queue_name: al2023

  - name: "code coverage"
    abort_commit_on_failure: true
    criteria: OPTIONAL
    # Playwright only works with certain distros of Linux
    queue_name: ci-queue-prodJenga-Ubuntu20
    script_path: /root/okta/odyssey/scripts
    script_name: code-coverage
    sort_order: "5"
    timeout: "20"

  - name: "interaction test"
    abort_commit_on_failure: true
    criteria: MERGE
    # Playwright only works with certain distros of Linux
    queue_name: ci-queue-prodJenga-Ubuntu20
    script_path: /root/okta/odyssey/scripts
    script_name: interaction-test
    sort_order: "6"
    timeout: "20"

  - name: "lint"
    abort_commit_on_failure: true
    criteria: MERGE
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "3"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn lint
        name: Lint Code
    timeout: "20"

  - name: "test"
    abort_commit_on_failure: true
    script_path: /root/okta/odyssey/scripts
    sort_order: "4"
    script_name: unit-test
    criteria: MERGE
    queue_name: al2023
    timeout: "20"

  - name: "typecheck"
    abort_commit_on_failure: true
    criteria: MERGE
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "3"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn typecheck
        name: Typecheck Code
    timeout: "20"

  - name: semgrep
    criteria: MERGE
    queue_name: al2023
    script_name: semgrep
    script_path: /root/okta/odyssey/scripts
    sort_order: "7"
    timeout: "10"
