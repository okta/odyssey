test_suites:
  - name: "Build Components"
    abort_commit_on_failure: true
    criteria: MERGE
    prereq_test_suite_names:
      - "Typecheck"
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "6"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn build
        name: Build Packages
    timeout: "20"

  - name: "Build Storybook"
    abort_commit_on_failure: true
    criteria: MERGE
    prereq_test_suite_names:
      - "Build Components"
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "6"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn build
        name: Build Packages
    timeout: "20"

  - name: "Code Coverage"
    abort_commit_on_failure: true
    criteria: MERGE
    prereq_test_suite_names:
      - "Build Components"
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "5"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn workspace @okta/odyssey-storybook coverage
        name: Report Code Coverage
    timeout: "20"

  - name: "Interaction Test"
    abort_commit_on_failure: true
    criteria: MERGE
    prereq_test_suite_names:
      - "Build Components"
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "4"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn workspace @okta/odyssey-storybook dev:interactionTest
        name: Test Interactions and Accessibility
    timeout: "20"

  - name: "Visual Regression Test"
    abort_commit_on_failure: true
    criteria: MERGE
    prereq_test_suite_names:
      - "build-components"
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "4"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn workspace @okta/odyssey-storybook dev:interactionTest
        name: Test Interactions and Accessibility
    timeout: "20"

  - name: "Lint"
    abort_commit_on_failure: true
    criteria: MERGE
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "1"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn lint
        name: Lint Code
    timeout: "20"

  - name: "Test"
    abort_commit_on_failure: true
    criteria: MERGE
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "3"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn test
        name: Test Code
    timeout: "20"

  - name: "Typecheck"
    abort_commit_on_failure: true
    criteria: MERGE
    queue_name: al2023
    script_path: /root/okta/odyssey/scripts
    sort_order: "2"
    steps:
      - event: SOURCE
        action: setup.sh
        name: Setup Environment
      - event: COMMAND
        action: yarn typecheck
        name: Typecheck Code
    timeout: "20"

  - name: "Semgrep"
    criteria: MERGE
    queue_name: al2023
    script_name: semgrep
    script_path: /root/okta/odyssey/scripts
    sort_order: "5"
    timeout: "10"
