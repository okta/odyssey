# Odyssey CLI (`@okta/odyssey-cli`)

Internal CLI tools for the Odyssey repo. This package provides a collection of commands built with `yargs` to automate
common development tasks and enforce consistency across packages, particularly for internationalization (i18n) setup.

## Table of Contents

- [Usage](#usage)
- [Commands](#commands)
  - [`build:translationsJson`](#buildtranslationsjson)
  - [`generate:i18n`](#generatei18n)
- [Contributing: Adding a New Command](#contributing-adding-a-new-command)

## Usage

This CLI is intended to be run from the root directory of a specific package within the monorepo. You can invoke it
using its binary name.

```bash
# General usage format
odyssey-cli <command> [options]
```

To see a list of all available commands and options, you can use the --help flag.

```bash
odyssey-cli --help
```

## Commands

Below is a detailed list of the available commands and their options.

### `build:translationsJson`

This command converts a `.properties` translation files into TypeScript modules.
It recursively searches a source directory for `.properties` files, parses them, and generates a corresponding `.ts`
file for each one in an output directory. Each generated file exports the translations as a `const` object.

By default, running the command in a package will read from `./src/properties` and write the generated `.ts` files to
`./src/properties/ts`.

This is the first step in our i18n pipeline.

```bash
odyssey-cli build:translationsJson [options]
```

#### Options

- `--propertiesFilesPath`
  - Description: A relative path to the source directory containing .properties files.
  - Type: `string`
  - Default: `"src/properties"`
- `--jsonOutputPath`
  - Description: A relative path to the output directory where the TypeScript files will be generated.
  - Type: `string`
  - Default: `"src/properties/ts"`

### `generate:i18n`

This command automates the creation of a fully typed `i18n` setup for the current package.
It reads the TypeScript translation modules (generated by the `build:translationsJson` command) and generates a set of
standardized `i18n` files in the `src/i18n.generated` directory.

These generated files provide type-safety for translation keys, configure the i18n translation provider, and export
ready-to-use hooks and functions.

#### Generated Files

- `i18n.resources.ts`: Imports all translation modules and aggregates them into a single resources object.
- `i18n.types.ts`: Creates TypeScript types for all translation keys based on the default language file, ensuring type
  safety and enabling autocompletion.
- `i18n.ts`: Exports a pre-configured `i18n` instance, `Trans` component, `TranslationProvider` and `useTranslation`
  hook for the package.

#### Usage

```bash
odyssey-cli generate:i18n
```

### Contributing: Adding a New Command

Adding new commands to the Odyssey CLI is straightforward. Follow the steps below to maintain the existing structure.

1. **Create the Command File**

   Create a new file for your command in the `src/commands/` directory. The file should be named after your command (
   e.g., `src/commands/myNewCommand.ts`).

2. **Define the Command Module**

   Inside your new file, define and export a `yargs` `CommandModule`. This object defines the command's name,
   description, options (builder), and logic (handler). Example, `src/commands/myNewCommand.ts`:

   ```typescript title="src/commands/myNewCommand.ts"
   import type { CommandModule } from "yargs";

   // Define the shape of your command's arguments
   export type MyNewCommandArgs = {
     myOption: string;
   };

   // The handler function contains your command's logic
   const whatMyNewCommandDoes = async (args: MyNewCommandArgs) => {
     console.log(`Executing my new command with option: ${args.myOption}`);
     // Your logic here...
   };

   // Export the command module
   export const myNewCommand: CommandModule<object, MyNewCommandArgs> = {
     command: "my-command:new",
     describe: "A description of what my new command does.",
     builder: (yargs) =>
       yargs.option("myOption", {
         describe: "Description for this option.",
         type: "string",
         default: "defaultValue",
       }),
     handler: myNewCommandHandler,
   };
   ```

3. **Export from Barrel File**

   Add an export for your new command in the barrel file at `src/commands/index.ts`.

   ```typescript
   export * from "./buildTranslationsJson";
   export * from "./generateI18n";
   export * from "./myNewCommand"; // Add this line
   ```

4. **Register the Command in the CLI**

   Finally, import your new command module in the main CLI entry point (`src/index.ts`) and register it with yargs.

   ```typescript
   import yargs from "yargs";
   import { hideBin } from "yargs/helpers";

   import {
     buildTranslationsJsonCommand,
     generateI18nCommand,
     myNewCommand, // 1. Import your command
   } from "./commands";

   yargs(hideBin(process.argv))
     .command(buildTranslationsJsonCommand)
     .command(generateI18nCommand)
     .command(myNewCommand) // 2. Register it here
     .demandCommand(1, "You must provide a valid command.")
     .strict()
     .strictCommands()
     .help()
     .parseAsync()
     .catch(console.error);
   ```

5. **Add a Test File**

   Remember to add a corresponding test file (e.g., `myNewCommand.node.test.ts`) in the `src/commands/` directory to
   ensure your command works as expected.
